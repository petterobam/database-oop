# XML文件实现数据存储和管理分析设计

## 多文件存储

1. 考虑到XML的容量和效率，还有数据管理问题，数据一定不能放到一个文件里面
2. 每一种业务数据存储，其层次要清晰，统一放到 ```classpath:/database/数据库名/表名/``` 下面
3. 每个表名目录下面有文件 ```data-0.xml、data-1.xml...data-N.xml``` ，用于存储数据 ， 每个文件存储数据量条数 10MB
4. 每个表名目录下面有文件 index-索引字段名.xml ，用于存储数据索引信息，主键默认会建立索引信息
5. 每个表名目录下面有文件 schema.xml , 用于存储表结构、索引字段、数据条数、总量等信息

## 库信息管理

1. ```classpath:/database/``` 下面会有一个默认的库，用来存储库和表相关的信息
2. ```classpath:/database/db_schema/``` 库下面有文件 ```database.xml、table.xml、index.xml、size.xml```
3. 库信息只做静态存储，提供静态库信息获取服务

## ```data-0..N.xml``` 的存储结构

1. 数据子节点 ```_datas->_data```
    - 都有 ```_id``` 节点，用于根据主键，数据查找
    - 都有 ```_source``` 节点，存储一整条 ```json``` 数据记录，用于结果集返回

2. 文档根节点
    - 都有 ```_md5IdIndexs``` 节点，```md5(id)``` 用 ```,``` 拼接到一起的字符串，用于快速定位
        - 数据插入按顺序，从前往后添加 ```_data``` 节点到 ```_datas``` 下面
        - 根据 ```查找md5(id)得到的下标/单个md5长度``` 得到对应id 的数据所在的 ```_datas``` 下的 ```index```下标 值
        - 修改的时候同样定位得到 ```index```下标 ， 但是 ```_id``` 不能被修改
        - 删除节点的时候，先得到 ```index```下标 ，删除 ```_datas``` 下面对应的 ``_`data``` 节点，如果 ```index = 0```，替换 ```md5(id) + ','``` 为空，否则替换 ```',' + md5(id)``` 为空
    - 每为非 ```_id``` 字段添加一个索引，就会添加 ```_md5[索引字段名]Indexs``` 节点，记录这个字段的索引字符集
    - 都有 ```_size``` 节点，记录文件的大小，单位 B
    - 都有 ```_count``` 节点，记录本文档的 ```_source``` 数据总数

## ```index-索引字段名.xml 的数据结构

1. 索引子节点 ```_indexs->_index```
    - 有 ```_value``` 节点，用于存储 索引字段原始值
    - 有 ```_md5``` 节点，用于存储 md5(索引字段原始值)
    - 有 ```_datafile``` 节点，用于存储 数据所在的 文件名（data-0..N.xml）
2. 文档根节点
    - 有 ```_md5Indexs``` 节点，```md5(索引字段原始值)``` 用 ```,``` 拼接到一起的字符串，用于定位索引节点
        - 索引数据插入按顺序，从前往后添加 ```_index``` 节点到 ```_indexs``` 下面
        - 根据 ```查找md5(索引字段原始值)得到的下标/单个md5长度``` 得到对应id 的数据所在的 ```_indexs``` 下的 ```index```下标 值
        - 修改的时候同样定位
        - 删除节点的时候，先得到 ```index``` 下标 ，删除 ```_indexs``` 下面对应的 ```_index``` 节点，如果 ```index = 0``` ，替换 ```md5(索引字段原始值) + ','``` 为空，否则替换 ```',' + md5(索引字段原始值)``` 为空